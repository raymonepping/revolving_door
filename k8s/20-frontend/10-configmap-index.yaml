apiVersion: v1
kind: ConfigMap
metadata:
  name: vault-door-frontend
  namespace: default
data:
  index.html: |
    <!doctype html>
    <html>
      <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Revolving Door</title>
        <style>
          body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#0b1220; color:#e8eefc; margin:0; padding:40px; }
          .card { max-width: 860px; margin: 0 auto; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10); border-radius: 16px; padding: 22px; box-shadow: 0 12px 30px rgba(0,0,0,0.35); }
          .row { display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap; }
          .badge { padding:10px 14px; border-radius: 999px; font-weight: 700; letter-spacing: 0.5px; }
          .open { background: rgba(34,197,94,0.18); border: 1px solid rgba(34,197,94,0.45); }
          .locked { background: rgba(239,68,68,0.14); border: 1px solid rgba(239,68,68,0.45); }
          pre { margin-top:16px; padding:14px; background: rgba(0,0,0,0.35); border-radius: 12px; overflow:auto; }
          .muted { opacity: 0.8; }
        </style>
      </head>
      <body>
        <div class="card">
          <div class="row">
            <div>
              <div class="muted">Vault + Kubernetes</div>
              <h1 style="margin:6px 0 0 0;">Revolving Door</h1>
            </div>
            <div id="state" class="badge locked">LOCKED</div>
          </div>

          <pre id="details">{ "loading": true }</pre>
          <div class="muted" style="margin-top:10px;">Polling /api every second.</div>
        </div>

        <script>
          const stateEl = document.getElementById("state");
          const detailsEl = document.getElementById("details");

          function setState(payload) {
            const door = (payload && payload.door) ? payload.door : "locked";
            if (door === "opened") {
              stateEl.textContent = "OPENED";
              stateEl.className = "badge open";
            } else {
              stateEl.textContent = "LOCKED";
              stateEl.className = "badge locked";
            }
            detailsEl.textContent = JSON.stringify(payload, null, 2);
          }

          async function tick() {
            try {
              const r = await fetch("/api", { cache: "no-store" });
              const payload = await r.json();
              setState(payload);
            } catch (e) {
              setState({ door: "locked", reason: "UI_FETCH_FAILED", error: String(e) });
            }
          }

          tick();
          setInterval(tick, 1000);
        </script>
      </body>
    </html>
